/*
ARIA Data Grid Module R1.0
Copyright 2010-2013 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
*/
(function(c){var b="grid"+$A.genId(),d=1;$A.DataGrid=function(f){var i=this,f=typeof f==="string"?$A.getEl(f):f,e=function(l){return l&&typeof l==="object"&&typeof l.length==="number"&&typeof l.splice==="function"&&!(l.propertyIsEnumerable("length"))},g={gridClass:"data-grid",gridReadOnlyClass:"data-grid-readonly",cellReadOnlyClass:"data-grid-cell-readonly",gridEditableClass:"data-grid-editable",gridSelectableClass:"data-grid-selectable",gridRowClass:"data-grid-row",gridCellClass:"data-grid-cell",gridCellToggleClass:"data-grid-cell-toggle",gridCellTogglePressedClass:"data-grid-cell-toggle-pressed",gridCellLinkClass:"data-grid-cell-link",gridRowFocusedClass:"data-grid-row-focused",gridCellFocusedClass:"data-grid-cell-focused",editFieldClass:"data-grid-cell-link-edit",edit:false,colHeaders:{map:[]},rowHeaders:{enabled:false,id:null},page:{row:{max:0,collectionMap:[],collection:{},toggleButtonRole:"Toggle Button",toggleButtonState:"Pressed",disabledText:"Disabled",editLinkAction:"Editable",build:function(m){d++;var l=b+"tr"+d;m.rowNodeId=l;m.rowNode=$A.createEl("tr",{role:"row",id:l},null,g.gridRowClass);for(id in m.cells){d++;var n=b+"td"+d;m.cells[id].id=id;m.cells[id].cellNodeId=n;m.cells[id].data={};m.cells[id].cellNode=$A.createEl("td",{id:n},null,g.gridCellClass);g.page.row.bindCell(m.cells[id],m.cells[id].cellNode,m,m.rowNode);m.cells[id].cellNodeA=$A.createEl("strong",{id:n+"a"},null,m.cells[id].type=="toggle"?g.gridCellToggleClass:g.gridCellLinkClass);m.cells[id].cellNodeS1=$A.createEl("span");m.cells[id].cellNodeS2=$A.createEl("span",null,$A.sraCSS);m.cells[id].cellNodeS3=$A.createEl("span",null,$A.sraCSS);m.cells[id].cellNode.appendChild(m.cells[id].cellNodeA);m.cells[id].cellNodeA.appendChild(m.cells[id].cellNodeS1);m.cells[id].cellNodeA.appendChild(m.cells[id].cellNodeS2);m.cells[id].cellNodeA.appendChild(m.cells[id].cellNodeS3);m.cells[id].rowObject=m;c.data(m.cells[id].cellNode,"celldata",{rowId:m.id,rowNodeId:m.rowNodeId,cellId:id,cellNodeId:m.cells[id].cellNodeId})}c.data(m.rowNode,"rowdata",{rowId:m.id,rowNodeId:m.rowNodeId})},trackPos:{row:0,col:0},resetPos:function(l){var n=c.data(l,"celldata");g.page.row.trackPos.row=$A.inArray(n.rowId,g.page.rendered)||0;for(var m=0;m<g.colHeaders.map.length;m++){if(n.cellId==g.colHeaders.map[m].id){g.page.row.trackPos.col=m;break}}return n},dblClickTitle:"Double click to activate",editFieldTitle:"Press Enter to save, or Escape to cancel.",cellOffset:function(l){var m=$A.xOffset(l.cellNodeA);m.height=$A.xHeight(l.cellNodeA);m.width=$A.xWidth(l.cellNodeA);return m},bindCell:function(n,l,r,o){var m=function(){l=n.cellNode;r=n.rowObject;o=n.rowObject.rowNode;if(g.edit&&!n.readonly){if(n.type=="toggle"){g.page.row.changed(l,n,n.value?false:true)}else{if(g.page.row.editFieldActive){k()}g.page.row.editFieldActive=n;$A.bind(g.page.row.editField,{"keydown.gridcontrol":function(u){var t=u.which||u.keyCode;if(t==13||t==27||t==9){u.preventDefault();if(t==13){g.page.row.changed(l,g.page.row.editFieldActive,this.value)}k(true)}},"blur.gridcontrol":function(t){t.preventDefault()}});g.page.row.editField.value=n.value;$A.setAttr(g.page.row.editField,{title:g.page.row.editFieldTitle});$A.query("body > *",function(t,u){$A.setAttr(u,"aria-hidden","true")});document.body.appendChild(g.page.row.editFieldDiv);$A.css(g.page.row.editFieldDiv,g.page.row.cellOffset(n));g.page.row.editField.focus();if(g.page.row.editLoad&&typeof g.page.row.editLoad==="function"){g.page.row.editLoad.apply(g.page.row.editField,[g.page.row.editField,n])}}}else{if(g.page.row.selectEnabled){var s=r.selected;if(!g.page.row.multiSelect){g.page.row.unselectAll()}if(!s||g.page.row.multiSelect){g.page.row.select(n)}if(!g.page.row.ariaSelect){$A.announce(n.cellNode)}}}},q=function(t,v){l=n.cellNode;r=n.rowObject;o=n.rowObject.rowNode;if(t==33){if(p.alt){g.page.first(n,r)}else{g.page.prev(n,r)}}else{if(t==34){if(p.alt){g.page.last(n,r)}else{g.page.next(n,r)}}else{if(t>=35&&t<=40){var s=false,u=g.page.rendered.length-1,w=g.colHeaders.map.length-1;if(t==35&&p.ctrl&&g.page.current<g.page.total){g.page.last(n,r,true);return}else{if(t==35&&p.ctrl&&g.page.current==g.page.total){g.page.row.trackPos.row=u;s=true}else{if(t==35&&g.page.row.trackPos.col<w){g.page.row.trackPos.col=w;s=true}else{if(t==36&&p.ctrl&&g.page.current>1){g.page.first(n,r);return}else{if(t==36&&p.ctrl&&g.page.current==1){g.page.row.trackPos.row=0;s=true}else{if(t==36&&g.page.row.trackPos.col>0){g.page.row.trackPos.col=0;s=true}else{if(t==37&&g.page.row.trackPos.col>0){g.page.row.trackPos.col-=1;s=true}else{if(t==38&&g.page.row.trackPos.row>0&&p.alt){g.page.row.trackPos.row=0;s=true}else{if(t==38&&g.page.row.trackPos.row>0){g.page.row.trackPos.row-=1;s=true}else{if(t==38&&g.page.row.trackPos.row==0){g.page.prev(n,r,true);return}else{if(t==39&&g.page.row.trackPos.col<w){g.page.row.trackPos.col+=1;s=true}else{if(t==40&&g.page.row.trackPos.row<u&&p.alt){g.page.row.trackPos.row=u;s=true}else{if(t==40&&g.page.row.trackPos.row<u){g.page.row.trackPos.row+=1;s=true}else{if(t==40&&g.page.row.trackPos.row>=u){g.page.next(n,r);return}}}}}}}}}}}}}}if(s){g.page.row.move({rowId:g.page.rendered[g.page.row.trackPos.row],cellId:g.colHeaders.map[g.page.row.trackPos.col].id})}}}}};var p={ctrl:false,alt:false};$A.bind(l,{"click.gridcontrol":function(u){var s=u.srcElement||u.target;if(s!=this||this!=g.page.row.focusedCell){g.page.row.move(g.page.row.resetPos(this))}if("ontouchstart" in window){n=j(this);m()}u.preventDefault()},"dblclick.gridcontrol":function(s){if(this!=g.page.row.focusedCell){g.page.row.move(g.page.row.resetPos(this))}if(!("ontouchstart" in window)){n=j(this);m()}s.stopPropagation();s.preventDefault()},"keydown.gridcontrol":function(u){var s=u.which||u.keyCode;p.ctrl=u.ctrlKey;p.alt=u.altKey;if((s>=33&&s<=40)||s==13||s==32||s==46||s==65){n=j(this);if(s==13||s==32){if(s==32&&p.ctrl){var w="";for(var t=0;t<g.colHeaders.map.length;t++){var v=g.colHeaders.map[t];w+=$A.getText(n.rowObject.cells[v.id].cellNode)+", "}$A.announce(w)}else{m()}}else{if(s>=33&&s<=40){q(s,u)}else{if(s==46&&g.page.row.deleteRow.enabled){g.page.row.deleteRow.callback();g.page.row.move()}else{if(s==65&&p.ctrl&&g.page.row.selectEnabled){g.page.row.selectAll();$A.announce(g.page.row.selectState)}}}}u.preventDefault()}},"keyup.gridcontrol":function(s){p.ctrl=false;p.alt=false},"focus.gridcontrol":function(s){n=j(this);$A.addClass(this,g.gridCellFocusedClass);$A.addClass(n.rowObject.rowNode,g.gridRowFocusedClass);if(this!=g.page.row.focusedCell){g.page.row.move(g.page.row.resetPos(this),true)}},"blur.gridcontrol":function(s){$A.query("tr."+g.gridRowFocusedClass+", td."+g.gridCellFocusedClass,g.dc.containerDiv,function(t,u){$A.remClass(u,g.gridRowFocusedClass+" "+g.gridCellFocusedClass)})}})},clean:function(m,l){$A.remAttr(m.rowNode,["title","aria-selected","aria-rowindex","aria-owns"]);$A.remClass(m.rowNode,g.gridRowFocusedClass+" "+g.page.row.selectClass);if(!l){c.removeData(m.rowNode,"rowdata")}for(var o in m.cells){$A.remAttr(m.cells[o].cellNode,["aria-labelledby","aria-describedby","tabindex","aria-colindex","aria-selected","aria-readonly"]);$A.remClass(m.cells[o].cellNode,g.cellReadOnlyClass+" "+g.gridCellFocusedClass+" "+(m.cells[o].toggleClass||g.gridCellTogglePressedClass));$A.remAttr(m.cells[o].cellNodeA,["title",]);m.cells[o].cellNodeS1.innerHTML="";m.cells[o].cellNodeS2.innerHTML="";m.cells[o].cellNodeS3.innerHTML="";if(!l){c.removeData(m.cells[o].cellNode,"celldata")}}},changed:function(l,n,o){var m=g.page.row.changed.cb&&typeof g.page.row.changed.cb==="function"?g.page.row.changed.cb.apply(l,[n,o,n.rowObject,i]):true;if(typeof m!=="boolean"){m=true}if(m){g.page.row.update(n.rowObject.id,n.id,o)}},selectEnabled:false,selectState:"Selected",selectClass:"selected",multiSelect:false,preserveSelect:false,ariaSelect:false,selected:[],select:function(q,l){var p=l||(q.rowObject.selected?false:true),o=g.page.row.select.cb&&typeof g.page.row.select.cb==="function"?g.page.row.select.cb.apply(q.rowObject.rowNode,[q.rowObject,p,g.page.row.selected,i]):true;if(typeof o!=="boolean"){o=true}if(o){q.rowObject.selected=p;var s=false;for(var r=g.page.row.selected.length-1;r>=0;r--){if(g.page.row.selected[r]===q.rowObject.id&&!q.rowObject.selected){g.page.row.selected.splice(r,1)}else{if(g.page.row.selected[r]===q.rowObject.id&&q.rowObject.selected){s=true}}}if(!s&&q.rowObject.selected){g.page.row.selected.push(q.rowObject.id)}var m=$A.inArray(q.rowObject.id,g.page.rendered)!==-1;if(m){var n="";if(q.rowObject.selected){$A.addClass(q.rowObject.rowNode,g.page.row.selectClass);n=g.page.row.selectState?g.page.row.selectState+". ":""}else{$A.remClass(q.rowObject.rowNode,g.page.row.selectClass)}n+=g.page.row.dblClickTitle;$A.setAttr(q.rowObject.rowNode,"title",n);if(g.page.row.ariaSelect){$A.setAttr(q.rowObject.rowNode,"aria-selected",q.rowObject.selected?"true":"false")}for(var r=0;r<g.colHeaders.map.length;r++){if(g.page.row.ariaSelect){$A.setAttr(q.rowObject.cells[g.colHeaders.map[r].id].cellNode,"aria-selected",q.rowObject.selected?"true":"false")}else{q.rowObject.cells[g.colHeaders.map[r].id].cellNodeS3.innerHTML=q.rowObject.selected?"<span>&nbsp;"+a(g.page.row.selectState)+"</span>":""}}}}},unselectAll:function(){for(var l=g.page.row.selected.length-1;l>=0;l--){var m=g.page.row.selected[l];g.page.row.select(g.page.row.collection[m].cells[g.colHeaders.map[0].id],false);g.page.row.selected.splice(l,1)}},selectAll:function(){if(g.page.row.selectEnabled&&g.page.row.multiSelect){if(!g.page.row.preserveSelect){g.page.row.unselectAll()}for(var l=0;l<g.page.rendered.length;l++){g.page.row.select(g.page.row.collection[g.page.rendered[l]].cells[g.colHeaders.map[0].id],true)}}},deleteRow:{enabled:false,callback:function(l){var q=g.page.row.deleteRow.callback.runBefore&&typeof g.page.row.deleteRow.callback.runBefore==="function"?g.page.row.deleteRow.callback.runBefore.apply(i,[l&&l.length?l:g.page.row.selected]):true;if(typeof q!=="boolean"){q=true}if(!q){return false}var m=[];if(l&&l.length){g.page.row.unselectAll();for(var r=0;r<l.length;r++){if(g.page.row.collection[l[r]]&&g.page.row.collection[l[r]].cells){g.page.row.selected.push(l[r])}}}var s=g.page.row.selected.length;for(var r=g.page.row.selected.length-1;r>=0;r--){var t=g.page.row.collection[g.page.row.selected[r]],v=$A.inArray(t.id,g.page.row.collectionMap);if(v!==-1){var u=g.page.row.deleteRow.callback.cb&&typeof g.page.row.deleteRow.callback.cb==="function"?g.page.row.deleteRow.callback.cb.apply(t.rowNode,[t,i]):true;if(typeof u!=="boolean"){u=true}if(u){m.push(t.id);g.page.row.clean(t);for(var o in t.cells){c(t.cells[o].cellNode).remove()}c(t.rowNode).remove();var p=$A.inArray(t.id,g.page.rendered);if(p!==-1){g.page.rendered.splice(p,1)}g.page.row.selected.splice(r,1);g.page.row.collectionMap.splice(v,1);delete g.page.row.collection[t.id]}}}if(s!=g.page.row.selected.length){g.page.row.trackPos.row=0;g.page.sync();g.page.open(g.page.current);if(g.page.row.deleteRow.callback.runAfter&&typeof g.page.row.deleteRow.callback.runAfter==="function"){g.page.row.deleteRow.callback.runAfter.apply(i,[m])}return true}return false}},update:function(q,p,s,l){if(!g.page.row.collection[q]||!g.page.row.collection[q].cells[p]){return}var m=g.page.row.collection[q].cells[p],n=m.type;g.page.row.collection[q].cells[p].value=n=="toggle"?(s?true:false):s;var r=$A.inArray(q,g.page.rendered);if(r!==-1){if(n=="toggle"){var o="&nbsp;"+a(g.page.row.toggleButtonRole);if(s){$A.addClass(m.cellNodeA,m.toggleClass||g.gridCellTogglePressedClass);o+="&nbsp;"+a(g.page.row.toggleButtonState)}else{$A.remClass(m.cellNodeA,m.toggleClass||g.gridCellTogglePressedClass)}if(m.readonly||g.page.row.selectEnabled||!g.edit){o+="&nbsp;"+a(g.page.row.disabledText)}m.cellNodeS2.innerHTML="<span>"+o+"</span>"}else{m.cellNodeS1.innerHTML="<span>"+a(s)+"</span>"}if(!l){$A.announce(m.cellNodeA)}}},focusedCell:null,move:function(p,m){if(!p&&g.page.row.focusedCell){setTimeout(function(){g.page.row.focusedCell.focus()},1);return}var l=g.page.row.focusedCell,n=g.page.row.collection[p.rowId].cells[p.cellId].cellNode;if(l&&l!=n){$A.setAttr(l,"tabindex","-1")}g.page.row.focusedCell=n;g.page.row.resetPos(n);$A.setAttr(n,"tabindex","0");if(!m){n.focus()}if(g.page.row.move.cb&&typeof g.page.row.move.cb==="function"){g.page.row.move.cb.apply(n,[n,l,g.dc,i])}}},pageRole:"Page",current:1,total:1,sync:function(s){var x=g.page.current,z=g.page.total;if(!g.page.row.max||!g.page.row.collectionMap.length){g.page.current=g.page.total=1}else{var m=g.page.row.max,v=g.page.row.collectionMap.length;if(m>=v){g.page.current=g.page.total=1}else{var q=Math.ceil(v/m);g.page.total=q;if(g.page.current>q){g.page.current=q}}}var o=[];if(s){if(s>g.page.row.total){s=g.page.row.total}var y=(s-1)*g.page.row.max,w=y+g.page.row.max;g.page.current=s;if(!g.page.row.max){w=g.page.row.collectionMap.length}for(var A=y;A<w;A++){var t=g.page.row.collectionMap[A];if(!(isNaN(t)&&!t)){g.page.row.collection[t].rowIndex=A+1;o.push(t)}}}if(x!=g.page.current||z!=g.page.total){if(g.page.indexChanged&&typeof g.page.indexChanged==="function"){g.page.indexChanged.apply(i,[g.page.current,g.page.total,i])}}if(s){return o}},on:{open:null,close:null,change:null,add:null,rem:null},open:function(o,m){if(g.page.row.editFieldActive){k(true,true)}if(isNaN(o)||o<1){o=1}if(m&&g.dc.loaded){g.page.close()}var l=g.dc.loaded;if(!l){g.dc.open()}g.page.render(g.page.sync(o));if(!l&&g.page.on.open&&typeof g.page.on.open==="function"){g.page.on.open.apply(f,[f,g.dc,i])}},close:function(){if(g.page.row.editFieldActive){k(true,true)}if(g.page.on.close&&typeof g.page.on.close==="function"){g.page.on.close.apply(f,[f,g.dc,i])}g.page.row.unselectAll();g.page.removeRendered();g.dc.close()},rendered:[],removeRendered:function(){if(!g.page.row.preserveSelect){g.page.row.unselectAll()}for(var l=0;l<g.page.rendered.length;l++){var p=g.page.rendered[l],m=g.page.row.collection[p];g.page.row.clean(m,true);if(g.page.on.rem&&typeof g.page.on.rem==="function"){g.page.on.rem.apply(m.rowNode,[m,g.dc,i])}for(var o in m.cells){if(m.cells[o].cellNode.parentNode){m.cells[o].cellNode.parentNode.removeChild(m.cells[o].cellNode)}}m.rowNode.parentNode.removeChild(m.rowNode)}g.page.rendered=[]},render:function(l){if(g.page.row.editFieldActive){k(true,true)}if(g.page.row.selectEnabled&&g.edit){g.edit=false}if(!g.dc.loaded){return}if(g.page.rendered.length){g.page.removeRendered()}g.page.rendered=l;var y={},v=[];for(var r=0;r<l.length;r++){d++;var w=g.page.row.collection[l[r]].rowNode,x=1,p=g.page.row.collection[l[r]].selected,s=p?g.page.row.selectState+". ":"";$A.addClass(w,g.gridRowClass);v.push(g.page.row.collection[l[r]].rowNodeId);if(g.page.row.selectEnabled){$A.setAttr(w,{title:s+g.page.row.dblClickTitle});if(g.page.row.ariaSelect){$A.setAttr(w,{"aria-selected":p?"true":"false"})}if(p){$A.addClass(w,g.page.row.selectClass)}}$A.setAttr(w,"aria-rowindex",g.page.row.collection[l[r]].rowIndex);var u=[];for(var q=0;q<g.colHeaders.map.length;q++){d++;var n=g.colHeaders.map[q],m=g.page.row.collection[l[r]].cells[n.id];$A.addClass(m.cellNode,g.gridCellClass);u.push(m.cellNodeId);if(n.colClass){$A.addClass(m.cellNode,n.colClass)}$A.setAttr(m.cellNode,{role:"gridcell","aria-colindex":x,"aria-labelledby":m.cellNodeId+"a","aria-describedby":g.rowHeaders.enabled&&g.rowHeaders.id&&g.rowHeaders.id!=m.id&&m.rowObject.cells[g.rowHeaders.id]?m.rowObject.cells[g.rowHeaders.id].cellNodeId+" "+n.thId:n.thId,tabindex:"-1"});if(g.rowHeaders.enabled&&g.rowHeaders.id&&g.rowHeaders.id==m.id){$A.setAttr(m.cellNode,{role:"rowheader",scope:"row"})}if(g.page.row.selectEnabled){if(m.type=="toggle"&&(g.page.row.toggleButtonRole||g.page.row.toggleButtonState)){var s=m.value?g.page.row.toggleButtonRole+" "+g.page.row.toggleButtonState:g.page.row.toggleButtonRole;$A.setAttr(m.cellNodeA,"title",s)}if(g.page.row.ariaSelect){$A.setAttr(m.cellNode,"aria-selected",p?"true":"false")}else{if(p){m.cellNodeS3.innerHTML=p?"<span>&nbsp;"+a(g.page.row.selectState)+"</span>":""}}}else{if(g.edit&&!m.readonly){var s="";if(m.type=="toggle"&&(g.page.row.toggleButtonRole||g.page.row.toggleButtonState)){s=m.value?g.page.row.toggleButtonRole+" "+g.page.row.toggleButtonState:g.page.row.toggleButtonRole;s+=". "}else{if(g.page.row.editLinkAction){s=g.page.row.editLinkAction+". "}}$A.setAttr(m.cellNodeA,"title",s+g.page.row.dblClickTitle)}else{if(m.type=="toggle"&&(g.page.row.toggleButtonRole||g.page.row.toggleButtonState)){var s=m.value?g.page.row.toggleButtonRole+" "+g.page.row.toggleButtonState:g.page.row.toggleButtonRole;$A.setAttr(m.cellNodeA,"title",s)}}}if(r===g.page.row.trackPos.row&&q===g.page.row.trackPos.col){y={rowId:l[r],cellId:n.id}}if(m.readonly||g.page.row.selectEnabled){$A.addClass(m.cellNode,g.cellReadOnlyClass)}if(m.type=="toggle"){m.cellNodeS1.innerHTML="<span>"+a(m.name)+"</span>";var t="&nbsp;"+a(g.page.row.toggleButtonRole);if(m.value){$A.addClass(m.cellNodeA,m.toggleClass||g.gridCellTogglePressedClass);t+="&nbsp;"+a(g.page.row.toggleButtonState)}else{$A.remClass(m.cellNodeA,m.toggleClass||g.gridCellTogglePressedClass)}if(m.readonly||g.page.row.selectEnabled||!g.edit){t+="&nbsp;"+a(g.page.row.disabledText)}m.cellNodeS2.innerHTML="<span>"+t+"</span>"}else{m.cellNodeS1.innerHTML="<span>"+a(m.value)+"</span>";if(g.edit&&!m.readonly){var t="&nbsp;"+a(g.page.row.editLinkAction);m.cellNodeS2.innerHTML="<span>"+t+"</span>"}}w.appendChild(m.cellNode);x+=1}$A.setAttr(w,"aria-owns",u.join(" "));g.dc.tbody.appendChild(w);if(g.page.on.add&&typeof g.page.on.add==="function"){g.page.on.add.apply(w,[g.page.row.collection[l[r]],g.dc,i])}}$A.setAttr(g.dc.tbody,"aria-owns",v.join(" "));if("rowId" in y&&"cellId" in y){g.page.row.move(y,true)}},prev:function(l,n,m){if(g.page.current>1){g.page.render(g.page.sync(g.page.current-1));g.page.row.move({rowId:g.page.rendered[m?g.page.rendered.length-1:0],cellId:l.id});$A.announce(g.page.pageRole+" "+g.page.current);if(g.page.on.change&&typeof g.page.on.change==="function"){g.page.on.change.apply(f,[g.page.current,g.page.total,i])}}},next:function(l,m){if(g.page.current<g.page.total){g.page.render(g.page.sync(g.page.current+1));g.page.row.move({rowId:g.page.rendered[0],cellId:l.id});$A.announce(g.page.pageRole+" "+g.page.current);if(g.page.on.change&&typeof g.page.on.change==="function"){g.page.on.change.apply(f,[g.page.current,g.page.total,i])}}},first:function(l,m){if(g.page.current>1){g.page.render(g.page.sync(1));g.page.row.move({rowId:g.page.rendered[0],cellId:l.id});$A.announce(g.page.pageRole+" "+g.page.current);if(g.page.on.change&&typeof g.page.on.change==="function"){g.page.on.change.apply(f,[g.page.current,g.page.total,i])}}},last:function(m,n,l){if(g.page.current<g.page.total){g.page.render(g.page.sync(g.page.total));g.page.row.move({rowId:l?g.page.rendered[g.page.rendered.length-1]:g.page.rendered[0],cellId:m.id});$A.announce(g.page.pageRole+" "+g.page.current);if(g.page.on.change&&typeof g.page.on.change==="function"){g.page.on.change.apply(f,[g.page.current,g.page.total,i])}}}}};d++;var h=b+"u"+d,j=function(l){var m=c.data(l||g.page.row.focusedCell,"celldata");return g.page.row.collection[m.rowId].cells[m.cellId]};g.page.row.editMaxLength=255;g.page.row.editFieldDiv=$A.createEl("div",{role:"application"},null,g.editFieldClass);g.page.row.editField=$A.createEl("input",{type:"text",maxlength:g.page.row.editMaxLength},null,g.editFieldClass);g.page.row.editFieldDiv.appendChild(g.page.row.editField);$A.bind(window,"resize."+h,function(){if(g.page.row.editFieldActive){$A.css(g.page.row.editFieldDiv,g.page.row.cellOffset(g.page.row.editFieldActive))}});var k=function(m,l){g.page.row.editField.value="";$A.unbind(g.page.row.editField,".gridcontrol");c(g.page.row.editFieldDiv).remove();if(m){g.page.row.editFieldActive=null;$A.query("body > *",function(n,p){$A.setAttr(p,"aria-hidden","false");$A.remAttr(p,"aria-hidden")});if(!l){g.page.row.move()}}};$A([{id:h,role:"Grid",showHiddenBounds:false,isStatic:f,runAfter:function(l){d++;l.tableId=b+"t"+d;l.theadId=b+"tth"+d;l.trId=b+"tthtr"+d;l.tbodyId=b+"ttb"+d;l.table=$A.createEl("table",{role:"grid",id:l.tableId,"aria-owns":l.theadId+" "+l.tbodyId},null,g.gridClass);if(g.edit){$A.addClass(l.table,g.gridEditableClass)}else{if(g.page.row.selectEnabled){$A.addClass(l.table,g.gridSelectableClass)}else{if(!g.edit&&!g.page.row.selectEnabled){$A.addClass(l.table,g.gridReadOnlyClass)}}}l.thead=$A.createEl("thead",{role:"rowgroup",id:l.theadId,"aria-owns":l.trId});l.tbody=$A.createEl("tbody",{role:"rowgroup",id:l.tbodyId});l.tr=$A.createEl("tr",{role:"row",id:l.trId},null,g.gridRowClass);l.table.appendChild(l.thead);l.table.appendChild(l.tbody);l.thead.appendChild(l.tr);var n=[];for(var m=0;m<g.colHeaders.map.length;m++){d++;var q=g.colHeaders.map[m],p=$A.createEl("th",{role:"columnheader",id:b+"th"+d,scope:"col","aria-labelledby":b+"th"+d+"s",tabindex:"-1"},null,g.gridCellClass);g.colHeaders.map[m].thId=b+"th"+d;n.push(b+"th"+d);if(q.colClass){$A.addClass(p,q.colClass)}$A.bind(p,"click",function(o){g.page.row.move()});p.innerHTML='<strong id="'+b+"th"+d+'s"><span>'+a(q.name)+"</span></strong>";l.tr.appendChild(p)}$A.setAttr(l.tr,"aria-owns",n.join(" "));l.containerDiv.appendChild(l.table)},runBeforeClose:function(l){if(l.table){c(l.table).remove()}l.table=l.thead=l.tbody=l.tr=null}}]);g.dc=$A.reg[h];i.id=h;i.getAccDCObject=function(){return g.dc};i.container=f;i.mapColumnNames=function(l){if(!l||typeof l!=="object"&&!l.length){return}g.colHeaders.map=[];for(var m=0;m<l.length;m++){g.colHeaders.map.push({id:l[m].id,name:l[m].lbl,colClass:l[m].colClass||""})}};i.changeColumnOrder=function(l,m){if(isNaN(l)||isNaN(m)||!g.colHeaders.map[l]||m>=g.colHeaders.map.length){return}var n=g.colHeaders.map.splice(l,1);n.splice(0,0,m,0);[].splice.apply(g.colHeaders.map,n)};i.enableRowHeaders=function(l,m){g.rowHeaders={enabled:l?true:false,id:m}};i.setRowMax=function(l){g.page.row.max=isNaN(l)?0:l};i.editable=function(l){g.edit=l?true:false};i.add=function(m){if(!e(m)){m=[m]}for(var l=0;l<m.length;l++){var n=m[l];if(!(!n||(isNaN(n.id)&&!n.id)||!n.cells)){if(n.id in g.page.row.collection){var o=$A.inArray(n.id,g.page.row.selected);if(o!==-1){g.page.row.selected.splice(o,1)}g.page.row.clean(g.page.row.collection[n.id]);c(g.page.row.collection[n.id].rowNode).remove();o=$A.inArray(n.id,g.page.row.collectionMap);if(o!==-1){g.page.row.collectionMap.splice(o,1)}delete g.page.row.collection[n.id]}g.page.row.build(n);g.page.row.collectionMap.push(n.id);g.page.row.collection[n.id]=n;g.page.sync()}}};i.setChangeListener=function(l){if(typeof l!=="function"){return}g.page.row.changed.cb=l};i.setPageChangeListener=function(l){if(typeof l!=="function"){return}g.page.on.change=l};i.setEditMaxLength=function(l){if(isNaN(l)){l=0}g.page.row.editMaxLength=l};i.setEditLoadListener=function(l){if(typeof l!=="function"){return}g.page.row.editLoad=l};i.setPageIndexChangeListener=function(l){if(typeof l!=="function"){return}g.page.indexChanged=l};i.setSelect=function(m,l){if(!m||typeof m!=="object"){return}if("enable" in m){g.page.row.selectEnabled=m.enable?true:false}if("toggleClass" in m){g.page.row.selectClass=m.toggleClass||"selected"}if("multiSelect" in m){g.page.row.multiSelect=m.multiSelect?true:false}if("ariaSelect" in m){g.page.row.ariaSelect=m.ariaSelect?true:false}if("preserve" in m){g.page.row.preserveSelect=m.preserve?true:false}if("callback" in m){g.page.row.select.cb=typeof m.callback==="function"?m.callback:null}};i.unselectAll=function(){g.page.row.unselectAll()};i.selectAll=function(){g.page.row.selectAll()};i.getSelected=function(){var l=[];for(var m=0;m<g.page.row.selected.length;m++){l.push(g.page.row.collection[g.page.row.selected[m]])}return l};i.select=function(m){if(!e(m)){m=[m]}for(var l=0;l<m.length;l++){var n=m[l],o=g.page.row.collection[n];if(o&&o.cells&&o.cells[g.colHeaders.map[0].id]){g.page.row.select(o.cells[g.colHeaders.map[0].id],true)}}};i.setDelete=function(l){if(!l||typeof l!=="object"){return}if("enable" in l){g.page.row.deleteRow.enabled=l.enable?true:false}if("callback" in l){g.page.row.deleteRow.callback.cb=typeof l.callback==="function"?l.callback:null}if("runBefore" in l){g.page.row.deleteRow.callback.runBefore=typeof l.runBefore==="function"?l.runBefore:null}if("runAfter" in l){g.page.row.deleteRow.callback.runAfter=typeof l.runAfter==="function"?l.runAfter:null}};i.deleteRows=function(l){if(g.page.row.deleteRow.enabled){if(l&&l.length){return g.page.row.deleteRow.callback(l)}else{return g.page.row.deleteRow.callback()}}return false};i.deleteAllRows=function(){if(g.page.row.deleteRow.enabled){return g.page.row.deleteRow.callback(g.page.row.collectionMap)}return false};i.setAccessibleText=function(l){if(!l||typeof l!=="object"){return}if("toggleButtonRole" in l){g.page.row.toggleButtonRole=l.toggleButtonRole}if("toggleButtonState" in l){g.page.row.toggleButtonState=l.toggleButtonState}if("disabledText" in l){g.page.row.disabledText=l.disabledText}if("editLinkAction" in l){g.page.row.editLinkAction=l.editLinkAction}if("pageRole" in l){g.page.pageRole=l.pageRole}if("editFieldTitle" in l){g.page.row.editFieldTitle=l.editFieldTitle}if("dblClickTitle" in l){g.page.row.dblClickTitle=l.dblClickTitle}if("selectState" in l){g.page.row.selectState=l.selectState}};i.setStaticClasses=function(l){if(!l||typeof l!=="object"){return}if("gridClass" in l){g.gridClass=l.gridClass}if("gridReadOnlyClass" in l){g.gridReadOnlyClass=l.gridReadOnlyClass}if("cellReadOnlyClass" in l){g.cellReadOnlyClass=l.cellReadOnlyClass}if("gridEditableClass" in l){g.gridEditableClass=l.gridEditableClass}if("gridSelectableClass" in l){g.gridSelectableClass=l.gridSelectableClass}if("gridRowClass" in l){g.gridRowClass=l.gridRowClass}if("gridCellClass" in l){g.gridCellClass=l.gridCellClass}if("gridCellToggleClass" in l){g.gridCellToggleClass=l.gridCellToggleClass}if("gridCellTogglePressedClass" in l){g.gridCellTogglePressedClass=l.gridCellTogglePressedClass}if("gridCellLinkClass" in l){g.gridCellLinkClass=l.gridCellLinkClass}if("gridRowFocusedClass" in l){g.gridRowFocusedClass=l.gridRowFocusedClass}if("gridCellFocusedClass" in l){g.gridCellFocusedClass=l.gridCellFocusedClass}if("editFieldClass" in l){g.editFieldClass=l.editFieldClass}};i.currentPage=function(){return g.page.current};i.totalPages=function(){return g.page.total};i.totalRows=function(){return g.page.row.collectionMap.length};i.openPage=function(m,l){if(isNaN(m)||m<1){return}g.page.open(m,l)};i.prevPage=function(){if(!g.dc.loaded){return}var l=j();g.page.prev(l,l.rowObject)};i.nextPage=function(){if(!g.dc.loaded){return}var l=j();g.page.next(l,l.rowObject)};i.firstPage=function(){if(!g.dc.loaded){return}var l=j();g.page.first(l,l.rowObject)};i.lastPage=function(){if(!g.dc.loaded){return}var l=j();g.page.last(l,l.rowObject)};i.setOpenListener=function(l){if(l&&typeof l==="function"){g.page.on.open=l}};i.setCloseListener=function(l){if(l&&typeof l==="function"){g.page.on.close=l}};i.setAddListener=function(l){if(l&&typeof l==="function"){g.page.on.add=l}};i.setRemoveListener=function(l){if(l&&typeof l==="function"){g.page.on.rem=l}};i.setMoveListener=function(l){if(l&&typeof l==="function"){g.page.row.move.cb=l}};i.getData=function(n,m,l){if(!n||!m||!l||!(n in g.page.row.collection)||!(m in g.page.row.collection[n].cells)){return null}return g.page.row.collection[n].cells[m].data[l]};i.setData=function(o,n,l,m){if(!o||!n||!l||!(o in g.page.row.collection)||!(n in g.page.row.collection[o].cells)){return}g.page.row.collection[o].cells[n].data[l]=m};i.getValue=function(m,l){if(!m||!l||!(m in g.page.row.collection)||!(l in g.page.row.collection[m].cells)){return null}return g.page.row.collection[m].cells[l].value};i.setValue=function(n,m,l){g.page.row.update(n,m,l,true)};i.setEditOffset=function(l){if(l&&typeof l==="function"){g.page.row.cellOffset=l}};i.open=function(l){g.page.open(l,true)};i.close=function(){g.page.close()};i.focus=function(){g.page.row.move()};return i};var a=function(g,h){var j="";if(typeof g==="number"){j=g.toString()}else{j=g}var e=j.length,f=[];while(e--){var k=j[e].charCodeAt();if(j[e]!="\n"&&(k<65||k>127||(k>90&&k<97))){f[e]="&#"+k+";"}else{f[e]=j[e]}}return f.join("")}})($A.internal);