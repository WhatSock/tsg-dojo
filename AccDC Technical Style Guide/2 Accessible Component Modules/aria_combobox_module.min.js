/*
ARIA Combobox Module R1.1
Copyright 2010-2015 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
*/
(function(){$A.Combobox=function(m,p,l){if(!m||!p){return null}var o=(p.nodeName.toLowerCase()=="input"||p.nodeName.toLowerCase()=="textarea")?true:false;if(!o&&!l){return null}if($A.getAttr(p,"role")!="combobox"){alert('The combobox element is missing the role="combobox" attribute, which is required.');return null}var q="cb"+$A.genId(),n=this,k=false,j=$A.createEl("div",{id:q+"pt"},{display:"none"});document.body.appendChild(j);$A.setAttr(p,"aria-describedby",j.id);if(!p.id){p.id=q+"cb"}$A([{id:q+"s",role:"Popup",returnFocus:false,showHiddenBounds:true,showHiddenClose:true,accClose:"Close Popup",displayHiddenClose:false,autoPosition:0,offsetLeft:0,offsetTop:0,className:"toplevel-div clearfix",middleClass:"middle-div clearfix",listboxClass:"listbox clearfix",optionClass:"option clearfix",activeClass:"active",toggleClass:"pressed",triggerObj:p,comboboxControl:true,cb:{sel:m,child:l,baseId:q,baseInc:1,options:{},optionNodes:[],size:0,readonly:false,required:false,parentTag:"ul",childTag:"li",names:[],values:[],matches:[],value:"",showAll:false,substringMatch:false,wordMatch:false,autoComplete:false,currentOption:null,activeDescendant:false,sIndex:-1,clicked:false,isInput:o,setDefault:true,bound:false,fn:{update:function(){var s=this.dc;n.close();s.cb.options={};s.cb.currentOption=null;s.cb.names=[];s.cb.values=[];s.cb.readonly=s.cb.isInput?($A.getAttr(s.triggerObj,"readonly")?true:false):true;s.cb.required=s.cb.isInput?($A.getAttr(s.triggerObj,"required")?true:false):($A.getAttr(s.triggerObj,"aria-required")=="true"?true:false);s.cb.optionNodes=$A.query("option",s.cb.sel);if(s.cb.readonly){s.cb.substringMatch=s.cb.wordMatch=false}for(var t=0;t<s.cb.optionNodes.length;t++){s.cb.baseInc++;var u=$A.createEl(s.cb.childTag,{role:"option",tabindex:"-1",id:s.cb.baseId+s.cb.baseInc},null,s.optionClass);s.cb.options[s.cb.optionNodes[t].value]={so:s.cb.optionNodes[t],no:c($A.getText(s.cb.optionNodes[t])).replace(/<|>/g,""),v:s.cb.optionNodes[t].value,i:t};u.innerHTML="<a><span>"+s.cb.options[s.cb.optionNodes[t].value].no+"</span></a>";s.cb.options[s.cb.optionNodes[t].value].o=u;s.cb.names.push(s.cb.options[s.cb.optionNodes[t].value].no);s.cb.values.push(s.cb.optionNodes[t].value)}s.cb.sel.selectedIndex=s.cb.sel.selectedIndex>=0?s.cb.sel.selectedIndex:0;s.cb.fn.setValue(s.cb.options[s.cb.optionNodes[s.cb.sel.selectedIndex].value],true);if(s.cb.required&&s.cb.isInput){$A.setAttr(s.triggerObj,{"aria-required":"true"})}},render:function(E,D){var H=this.dc;if(H.cb.readonly){var I=H.cb.showAll;H.cb.showAll=true}if(!H.cb.readonly&&!H.cb.showAll&&!H.cb.value){H.cb.showAll=I;return true}if(!D){H.cb.sIndex=H.cb.sel.selectedIndex;H.cb.matches=[];n.close()}if(D){var F=H.cb.value.toLowerCase(),t=false,u=H.cb.sIndex;H.cb.sIndex++;for(var w=H.cb.sIndex;w<H.cb.names.length;w++){if($A.inArray(F,H.cb.names[w].toLowerCase())===0){t=true;H.cb.sIndex=w;break}}if(!t){H.cb.sIndex=0;for(var w=H.cb.sIndex;w<u;w++){if($A.inArray(F,H.cb.names[w].toLowerCase())===0){t=true;H.cb.sIndex=w;break}}}if(!t){H.cb.sIndex=u}else{H.cb.currentOption=H.cb.options[H.cb.values[H.cb.sIndex]];H.cb.value=H.cb.currentOption.no;$A.setAttr(H.triggerObj,"aria-activedescendant",H.cb.currentOption.o.id);$A.remClass($A.query("."+H.activeClass,H.source),H.activeClass);$A.addClass(H.cb.currentOption.o,H.activeClass);n.scrollIntoView(H.cb.currentOption.o)}}else{if(E||H.cb.showAll||H.cb.readonly){H.cb.matches=H.cb.values}else{for(var w=0;w<H.cb.names.length;w++){if(H.cb.wordMatch){var s=c(H.cb.value).toLowerCase().split(" "),G=c(H.cb.names[w]).toLowerCase().split(" "),C=0,x=0;for(var A=0;A<s.length;A++){for(var B=0;B<G.length;B++){if(c(s[A])&&c(G[B])&&$A.inArray(c(s[A]),c(G[B]))!==-1&&c(s[A]).length==c(G[B]).length){x++;break}}C++}if(C&&x&&C<=x){H.cb.matches.push(H.cb.values[w])}}else{if((!H.cb.wordMatch&&!H.cb.substringMatch&&$A.inArray(H.cb.value.toLowerCase(),H.cb.names[w].toLowerCase())===0)||(!H.cb.wordMatch&&H.cb.substringMatch&&$A.inArray(H.cb.value.toLowerCase(),H.cb.names[w].toLowerCase())!==-1)){H.cb.matches.push(H.cb.values[w])}}}}if(!H.cb.matches.length){return true}if(H.cb.readonly){H.cb.sIndex=H.cb.sel.selectedIndex}else{H.cb.sIndex=0}if(H.cb.readonly){H.cb.showAll=I;H.cb.activeDescendant=true;H.cb.currentObject=H.cb.options[H.cb.matches[H.cb.sIndex]]}}return false},setAltTrigger:function(t){if(!t||t.nodeType!==1){return}var s=this.dc;if("ontouchstart" in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0){$A.setAttr(t,{"aria-label":(function(){var x="",w=$A.getText(t),z=$A.getAttr(t,"aria-labelledby"),v=$A.getAttr(t,"aria-label"),A=$A.getAttr(t,"title");if(w){x=w}else{if(z){var u=z.split(" ");for(var y=0;y<u.length;y++){x+=$A.getText($A.getEl(u[y]))}}else{if(v){x=v}else{if(A){x=A}}}}return x})(),role:"button","aria-expanded":"false"})}else{$A.setAttr(t,{"aria-hidden":"true",tabindex:"-1"})}s.cb.altClicked=false;$A.bind(t,"click",function(u){if(!s.cb.altClicked){s.cb.altClicked=true;if(!s.loaded){n.open()}else{n.close()}s.triggerObj.focus();setTimeout(function(){s.cb.altClicked=false},300)}u.preventDefault()});s.cb.altTrigger=t},setValue:function(v,w,u){var s=this.dc;s.cb.value=v.no;s.cb.currentOption=v;if(!w){v.so.selected=true}if(!w&&s.cb.fn.onSelect&&typeof s.cb.fn.onSelect==="function"){var t=s.cb.fn.onSelect.apply(s.triggerObj,[v.no,v.v,s.triggerObj,s.cb.sel]);if(t){s.cb.value=t}}else{if(s.cb.isInput){if(u||s.cb.setDefault){s.triggerObj.value=s.cb.value}}else{if(u||s.cb.setDefault){s.cb.child.innerHTML=s.cb.value}}}s.cb.pValue=s.cb.value},checkValue:function(t){var s=this.dc;for(var u=0;u<s.cb.names.length;u++){if(c(t)&&c(t.toLowerCase())==c(s.cb.names[u].toLowerCase())){return u}}return -1},unsetValue:function(t){var s=this.dc;if(!t&&s.cb.sel.selectedIndex>=0){s.cb.optionNodes[s.cb.sel.selectedIndex].selected=false}s.cb.currentOption=null;if(s.cb.isInput){s.cb.value=s.triggerObj.value}else{s.cb.value=$A.getText(s.cb.child)}},bind:function(){var s=this.dc;if(s.cb.bound){return}$A.bind(s.triggerObj,{keydown:function(u){var v=this,t=u.which||u.keyCode;if(t==9){if(s.loaded){if(s.cb.autoComplete&&s.cb.activeDescendant){s.cb.fn.setValue(s.cb.options[s.cb.matches[s.cb.sIndex]],false,true)}n.close()}}else{if(t==13&&!s.cb.isInput&&!s.cb.activeDescendant&&!s.loaded){n.open();u.preventDefault()}else{if(t==13&&s.cb.activeDescendant&&s.loaded){s.cb.fn.setValue(s.cb.options[s.cb.matches[s.cb.sIndex]],false,true);n.close();if(!(s.cb.fn.onSelect&&typeof s.cb.fn.onSelect==="function")){setTimeout(function(){$A.announce(s.cb.value,false,true)},100)}u.preventDefault()}else{if(t>=37&&t<=40){u.preventDefault()}}}}},keypress:function(u){var v=this,t=u.which||u.keyCode;if(s.cb.readonly&&t!==0){s.cb.value=String.fromCharCode(t);s.cb.fn.render(false,true)}},keyup:function(y){var z=this,u=y.which||y.keyCode;if(s.cb.readonly&&s.loaded&&(u==37||u==39)){}else{if(((y.altKey&&u==40)||u==40)&&!s.cb.activeDescendant&&!s.loaded&&s.cb.readonly){s.cb.activeDescendant=true;s.cb.sIndex=((s.cb.readonly||s.cb.showAll)&&s.cb.sel.selectedIndex>=0)?s.cb.sel.selectedIndex:0;n.open();y.preventDefault()}else{if(((y.altKey&&u==40)||u==40)&&!s.cb.activeDescendant&&s.loaded&&!s.cb.readonly){s.cb.activeDescendant=true;s.cb.sIndex=((s.cb.readonly||s.cb.showAll)&&s.cb.sel.selectedIndex>=0)?s.cb.sel.selectedIndex:0;$A.setAttr(z,{"aria-expanded":"true","aria-activedescendant":s.cb.options[s.cb.matches[s.cb.sIndex]].o.id});$A.remClass($A.query("."+s.activeClass,s.source),s.activeClass);$A.addClass(s.cb.options[s.cb.matches[s.cb.sIndex]].o,s.activeClass);n.scrollIntoView(s.cb.options[s.cb.matches[s.cb.sIndex]].o);y.preventDefault()}else{if(u==40&&s.cb.activeDescendant&&s.loaded){if(s.cb.sIndex<s.cb.matches.length-1){s.cb.sIndex++;$A.setAttr(z,"aria-activedescendant",s.cb.options[s.cb.matches[s.cb.sIndex]].o.id);$A.remClass($A.query("."+s.activeClass,s.source),s.activeClass);$A.addClass(s.cb.options[s.cb.matches[s.cb.sIndex]].o,s.activeClass);n.scrollIntoView(s.cb.options[s.cb.matches[s.cb.sIndex]].o)}y.preventDefault()}else{if(y.altKey&&u==38&&s.cb.activeDescendant&&s.loaded){s.cb.fn.setValue(s.cb.options[s.cb.matches[s.cb.sIndex]],false,true);n.close();if(!(s.cb.fn.onSelect&&typeof s.cb.fn.onSelect==="function")){setTimeout(function(){$A.announce(s.cb.value,false,true)},100)}y.preventDefault()}else{if(u==38&&s.cb.activeDescendant&&s.loaded){if(s.cb.sIndex>0){s.cb.sIndex--;$A.setAttr(z,"aria-activedescendant",s.cb.options[s.cb.matches[s.cb.sIndex]].o.id);$A.remClass($A.query("."+s.activeClass,s.source),s.activeClass);$A.addClass(s.cb.options[s.cb.matches[s.cb.sIndex]].o,s.activeClass);n.scrollIntoView(s.cb.options[s.cb.matches[s.cb.sIndex]].o)}y.preventDefault()}else{if(u==27||u==37||u==39){$A.setAttr(z,{"aria-expanded":"false","aria-activedescendant":"","aria-controls":""});s.cb.activeDescendant=false;$A.remClass($A.query("."+s.activeClass,s.source),s.activeClass);if(u==27){n.close()}}else{if(!s.cb.readonly&&u!=9&&!(u==9&&y.shiftKey)){if(s.cb.isInput){s.cb.value=z.value}var t=s.cb.fn.checkValue(s.cb.value);if(s.cb.value&&t!==-1){var w=s.cb.options[s.cb.values[t]];s.cb.currentOption=w;w.so.selected=true;n.close()}else{if(s.cb.value){var v=(s.cb.isInput&&!s.cb.readonly)?true:false;if(v){if(!s.cb.pValue||s.cb.pValue.length!=p.value.length){s.cb.pValue=p.value;v=false}}if(!v){s.cb.fn.render();n.open(true)}}else{n.close()}}}}}}}}}}},click:function(t){if(!s.cb.altTrigger){if(!s.cb.isInput&&!s.loaded){n.open()}else{if(!s.cb.isInput&&s.loaded){n.close()}}}t.preventDefault()},focus:function(t){},blur:function(t){if(!("ontouchstart" in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){setTimeout(function(){if(!s.cb.altClicked){if(s.loaded){if(s.cb.autoComplete&&s.cb.activeDescendant&&!s.cb.clicked){s.cb.fn.setValue(s.cb.options[s.cb.matches[s.cb.sIndex]],false,true)}n.close()}s.cb.clicked=false}},150)}}});s.cb.bound=true},set:function(){var s=this.dc;$A.setAttr(s.triggerObj,{"aria-expanded":"false","aria-autocomplete":"list","aria-activedescendant":"","aria-controls":""});if(!s.cb.isInput){s.cb.baseInc++;if(!s.cb.child.id){$A.setAttr(s.cb.child,{tabindex:"-1",id:s.cb.baseId+s.cb.baseInc})}e(s.triggerObj,s.cb.child.id)}},onSelect:null,onOpen:null,onClose:null,onTriggerChange:null,setSize:function(){var t=this.dc,v=(t.cb.size||5)<=t.cb.matches.length?(t.cb.size||5):t.cb.matches.length,w=t.cb.options[t.cb.matches[0]].o,u=a(w);u+=parseInt($A.css(w,"margin-top"))+parseInt($A.css(w,"margin-bottom"));u=(v*u)+(parseInt($A.css(t.source,"padding-top"))+parseInt($A.css(t.source,"padding-bottom")));$A.css(t.source,"height",u)}}},runBefore:function(s){if(!s.cb.matches.length){return s.cancel=true}s.cb.baseInc++;s.source=$A.createEl(s.cb.parentTag,{"aria-label":(function(){var y="",A=$A.getAttr(s.triggerObj,"aria-labelledby"),w=$A.getAttr(s.triggerObj,"aria-label"),x=s.triggerObj.id,B=$A.getAttr(s.triggerObj,"title");if(A){var v=A.split(" ");for(var z=0;z<v.length;z++){y+=$A.getText($A.getEl(v[z]))}}else{if(w){y=w}else{if(x){var u=$A.getText($A.query('label[for="'+x+'"]')[0]);if(u){y=u;return y}}}}if(!y&&B){y=B}return y})(),role:"listbox",id:s.cb.baseId+s.cb.baseInc},null,s.listboxClass);for(var t=0;t<s.cb.matches.length;t++){s.source.appendChild(s.cb.options[s.cb.matches[t]].o)}$A.find("*",function(u){if(u.comboboxControl&&u.loaded){u.close()}})},runDuring:function(s){$A.setAttr(s.triggerObj,{"aria-controls":s.source.id});$A.addClass(s.containerDiv,s.middleClass);if(s.showHiddenBounds){s.fn.sraStart.innerHTML=s.fn.sraEnd.innerHTML="";$A.setAttr(s.fn.sraStart,"aria-hidden","true");$A.setAttr(s.fn.sraEnd,"aria-hidden","true")}},runAfter:function(s){$A.query(s.cb.matches,function(u,t){$A.bind(s.cb.options[t].o,"click",function(v){s.cb.fn.setValue(s.cb.options[t],false,true);s.cb.clicked=true;n.close();if(!(s.cb.fn.onSelect&&typeof s.cb.fn.onSelect==="function")){setTimeout(function(){$A.announce(s.cb.value,false,true)},100)}v.preventDefault()})});if(s.cb.readonly){$A.setAttr(s.triggerObj,{"aria-expanded":"true","aria-activedescendant":s.cb.options[s.cb.matches[s.cb.sIndex]].o.id});$A.remClass($A.query("."+s.activeClass,s.source),s.activeClass);$A.addClass(s.cb.options[s.cb.matches[s.cb.sIndex]].o,s.activeClass)}s.cb.fn.setSize();n.scrollIntoView(s.cb.options[s.cb.matches[s.cb.sIndex]].o);s.cb.options[s.cb.matches[s.cb.sIndex]].no.announce(null,false,true);if(s.cb.altTrigger&&s.cb.altTrigger.nodeType===1){$A.addClass(s.cb.altTrigger,s.toggleClass);$A.setAttr(s.cb.altTrigger,{"aria-expanded":"true"});if(s.cb.fn.onTriggerChange&&typeof s.cb.fn.onTriggerChange==="function"){s.cb.fn.onTriggerChange.apply(s.cb.altTrigger,[s.cb.altTrigger,s.loaded])}}if(s.cb.fn.onOpen&&typeof s.cb.fn.onOpen==="function"){s.cb.fn.onOpen.apply(s.triggerObj,[s])}},runAfterClose:function(s){if(s.cb.altTrigger&&s.cb.altTrigger.nodeType===1){$A.remClass(s.cb.altTrigger,s.toggleClass);$A.setAttr(s.cb.altTrigger,{"aria-expanded":"false"});if(s.cb.fn.onTriggerChange&&typeof s.cb.fn.onTriggerChange==="function"){s.cb.fn.onTriggerChange.apply(s.cb.altTrigger,[s.cb.altTrigger,s.loaded])}}if(s.cb.fn.onClose&&typeof s.cb.fn.onClose==="function"){s.cb.fn.onClose.apply(s.triggerObj,[s])}}}],null,false,true);var r=$A.reg[q+"s"];r.cb.dc=r.cb.fn.dc=n.dc=r;n.combobox=r.triggerObj;n.select=r.cb.sel;r.targetObj=r.triggerObj;n.setShowAll=function(s){r.cb.showAll=s?true:false};n.setSubstringMatch=function(s){r.cb.substringMatch=s?true:false};n.setWordMatch=function(s){r.cb.wordMatch=s?true:false};n.setTags=function(s){if(s.parentTag){r.cb.parentTag=s.parentTag}if(s.childTag){r.cb.childTag=s.childTag}};n.setOffset=function(s){if(!isNaN(s.left)){r.offsetLeft=s.left}if(!isNaN(s.top)){r.offsetTop=s.top}};n.setAutoComplete=function(s){r.cb.autoComplete=s?true:false};n.close=function(){$A.setAttr(r.triggerObj,{"aria-expanded":"false","aria-activedescendant":"","aria-controls":""});$A.remClass($A.query("."+r.activeClass,r.source),r.activeClass);r.close();r.cb.activeDescendant=false};n.open=function(s){if(r.loaded){return}if(k){r.cb.fn.render();r.open();if(r.loaded){if(!s){$A.setAttr(r.triggerObj,{"aria-expanded":"true","aria-activedescendant":r.cb.options[r.cb.matches[r.cb.sIndex]].o.id});$A.remClass($A.query("."+r.activeClass,r.source),r.activeClass);$A.addClass(r.cb.options[r.cb.matches[r.cb.sIndex]].o,r.activeClass)}n.scrollIntoView(r.cb.options[r.cb.matches[r.cb.sIndex]].o)}}};n.setAltTrigger=function(s){r.cb.fn.setAltTrigger(s)};n.setAutoPosition=function(s){if(!isNaN(s)&&s<10){r.autoPosition=s}};n.setSize=function(s){if(!isNaN(s)&&s>0){r.cb.size=s}};n.setPosAnchor=function(s){r.posAnchor=s};n.setTargetObj=function(s){r.targetObj=s};n.setClassNames=function(s){if(s.toplevelClass){r.className=s.toplevelClass}if(s.middleClass){r.middleClass=s.middleClass}if(s.listboxClass){r.listboxClass=s.listboxClass}if(s.optionClass){r.optionClass=s.optionClass}if(s.activeClass){r.activeClass=s.activeClass}if(s.toggleClass){r.toggleClass=s.toggleClass}};n.setDefault=function(s){r.cb.setDefault=s?true:false};n.update=function(){r.cb.fn.update()};n.start=function(){k=true;r.cb.fn.bind();r.cb.fn.update();if(document.activeElement==p&&(r.cb.readonly||r.cb.value)){n.open()}};n.stop=function(){k=false;n.close()};n.onSelect=function(s){if(s&&typeof s==="function"){r.cb.fn.onSelect=s}};n.onOpen=function(s){if(s&&typeof s==="function"){r.cb.fn.onOpen=s}};n.onClose=function(s){if(s&&typeof s==="function"){r.cb.fn.onClose=s}};n.onTriggerChange=function(s){if(s&&typeof s==="function"){r.cb.fn.onTriggerChange=s}};n.setPromptText=function(t){j.innerHTML=t};n.setCloseText=function(t){if(!t){r.showHiddenBounds=false}else{r.showHiddenBounds=true;r.accClose=t}};n.scrollIntoView=function(t){var s=document.documentElement.scrollLeft;t.scrollIntoView();if(document.documentElement.scrollLeft!=s){document.documentElement.scrollLeft=s}};$A.bind(window,"resize",function(){if(r.loaded){r.setPosition();r.cb.fn.setSize()}});if(!r.cb.isInput&&!$A.getAttr(r.triggerObj,"tabindex")){$A.setAttr(r.triggerObj,"tabindex","0")}r.cb.fn.set()};var c=function(j){return j.replace(/^\s+|\s+$/g,"")},e=function(p,s){if(!p){return null}var q=$A.isArray(p)?p:[p],m=s.split(" ");for(var k=0;k<q.length;k++){for(var r=0;r<m.length;r++){if(!i(q[k],m[r])){var j=$A.getAttr(q[k],"aria-labelledby");if(!j){j=""}$A.setAttr(q[k],"aria-labelledby",c(j+" "+m[r]))}}}return p},i=function(o,q){var j=$A.getAttr(o,"aria-labelledby");if(!o||!j){return false}var m=q.split(" "),k=0;for(var p=0;p<m.length;p++){if(j.indexOf(m[p])!==-1){k+=1}}if(k===m.length){return true}return false},a=function(o,m){var l,n=0,k=0,j=0,p=0;if(!o){return 0}if(b(m)){if(m<0){m=0}else{m=Math.round(m)}}else{m=-1}l=h(o.style);if(l&&h(o.offsetHeight)&&d(o.style.height)){if(m>=0){if(document.compatMode=="CSS1Compat"){n=f(o,"padding-top",1);if(n!==null){k=f(o,"padding-bottom",1);j=f(o,"border-top-width",1);p=f(o,"border-bottom-width",1)}else{if(h(o.offsetHeight,o.style.height)){o.style.height=m+"px";n=o.offsetHeight-m}}}m-=(n+k+j+p);if(isNaN(m)||m<0){return}else{o.style.height=m+"px"}}m=o.offsetHeight}else{if(l&&h(o.style.pixelHeight)){if(m>=0){o.style.pixelHeight=m}m=o.style.pixelHeight}}return m},b=function(){for(var j=0;j<arguments.length;j++){if(isNaN(arguments[j])||typeof arguments[j]!=="number"){return false}}return true},h=function(){for(var j=0;j<arguments.length;j++){if(typeof arguments[j]==="undefined"){return false}}return true},d=function(){for(var j=0;j<arguments.length;j++){if(typeof arguments[j]!=="string"){return false}}return true},f=function(o,n,l){if(!o){return null}var m,j="undefined",k=document.defaultView;if(k&&k.getComputedStyle){if(o==document){o=document.body}m=k.getComputedStyle(o,"");if(m){j=m.getPropertyValue(n)}}else{if(o.currentStyle){j=o.currentStyle[g(n)]}else{return null}}return l?(parseInt(j)||0):j},g=function(k){var l,n,j,m;j=k.split("-");m=j[0];for(l=1;l<j.length;l++){n=j[l].charAt(0);m+=j[l].replace(n,n.toUpperCase())}return m}})();