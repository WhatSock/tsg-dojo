/*
ARIA Listbox Generator Module R2.7
Copyright 2010-2016 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(){$A.Listbox=function(x,y){var y=y||{},i=y.grabInstruct||"Press Space to grab",u=y.dropInstruct||"Press Space to drop",w=y.grabMsg||"Grabbed",t=y.dropMsg||"Moved",e=y.cancelDrop||"Grab canceled",j=function(A){return A&&typeof A==="object"&&typeof A.length==="number"&&typeof A.splice==="function"&&!(A.propertyIsEnumerable("length"))},x=typeof x==="string"?$A.getEl(x):x,h=this;h.index=isNaN(y.defaultIndex)?0:y.defaultIndex;var o={},q={},s=0,n=y.isMultiselect?[]:"",m=function(A,B){if(A!=h.index||B){$A.query("#"+x.id+" > li > a",function(C,D){$A.setAttr(D,{tabindex:"-1"});if(!y.isMultiselect){$A.setAttr(D,{"aria-selected":"false"})}})}if(h.options[A]){$A.setAttr(h.options[A],{tabindex:"0"});if(!y.isMultiselect){$A.setAttr(h.options[A],{"aria-selected":"true"})}h.options[A].scrollIntoView();h.index=A;h.grabbed=r;if(B){h.options[A].focus()}if(!y.isMultiselect){n=h.options[A].id}if(y.callback&&typeof y.callback==="function"){setTimeout(function(){y.callback.apply(h,[h.options[A],h.options])},1)}}},a=function(){n=[];for(id in q){if(q[id]){n.push(id)}}},r="",f=function(){$A.query("#"+x.id+" > li > a",function(A,B){$A.remAttr(B,"aria-grabbed");$A.setAttr(B,"aria-dropeffect","move")});r=this.id;$A.setAttr(this,"aria-grabbed","true");$A.remAttr(this,"aria-dropeffect");m(o[r]);$A.announce(w)},g=function(B){$A.query("#"+x.id+" > li > a",function(C,D){$A.remAttr(D,"aria-dropeffect");$A.setAttr(D,"aria-grabbed","false")});if(!B){x.insertBefore(h.options[o[r]].parentNode,h.options[h.index].parentNode);v(true);$A.announce(t)}else{$A.announce(e)}var A=r;r="";m(B?h.index:o[A],B?false:true)},k=function(F){if(!h.options.length){h.empty=true}if(F){if(r){g.apply(this,[true])}var E=j(F),C=E?F:[F],D=h.options.length;for(var B=0;B<C.length;B++){var F=C[B],A=$A.createEl("li");if(!F||F.nodeType!==1||!F.id){return}$A.setAttr(F,{role:"option",tabindex:"-1","aria-selected":"false"});if(!$A.getAttr(F,"aria-labelledby")&&!$A.getAttr(F,"aria-label")){$A.setAttr(F,{"aria-label":z(F).name})}if(y.isSortable||y.isMultiselect){$A.setAttr(F,y.isSortable?"aria-grabbed":"aria-selected","false")}A.appendChild(F);x.appendChild(A);b(F)}v(true);if(D<h.options.length){m(D)}}},c=function(E,F){if(h.options.length){if(r){g.apply(this,[true])}var H=j(E),B=H?E:[E],D=[];for(var A=0;A<B.length;A++){var G=h.options[B[A]];$A.unbind(G,".arialistbox");var C=G.parentNode;D.push(C.removeChild(G));x.removeChild(C)}n=y.isMultiselect?[]:"";v();if(h.index>s){h.index=s}if(h.options.length){m(h.options[h.index]?h.index:0,F?false:true)}return H?D:D[0]}},d=function(){if(y.isSortable){if(r){g.apply(this)}else{f.apply(this)}}else{if(y.isMultiselect){q[this.id]=q[this.id]?false:true;$A.setAttr(this,"aria-selected",q[this.id]?"true":"false");a();m(h.index)}}},b=function(A){if(!A){$A.bind(x,"focusin.arialistbox",function(){if(y.isSortable){$A.announce(r?u:i,true)}})}$A.bind(A||"#"+x.id+" > li > a",{"click.arialistbox":function(B){B.preventDefault();if(y.isSortable){m(o[this.id]);d.apply(this)}else{if(y.isMultiselect){q[this.id]=q[this.id]?false:true;$A.setAttr(this,"aria-selected",q[this.id]?"true":"false");a()}}m(o[this.id])},"keydown.arialistbox":function(D){var B=D.which||D.keyCode;if(B==13){$A.trigger(this,"click")}else{if(B==27&&r){g.apply(this,[true]);D.preventDefault()}else{if(B==32){d.apply(this);D.preventDefault()}else{if(B==38){D.preventDefault();if(h.index>0){m(h.index-1,true)}}else{if(B==40){D.preventDefault();if(h.index<s){m(h.index+1,true)}}else{if(B==35){D.preventDefault();m(s,true)}else{if(B==36){D.preventDefault();m(0,true)}else{if(B==33){D.preventDefault();var C=h.index-parseInt((s*(s>=20?0.1:0.5)));if(h.index!=C){m(C>0?C:0,true)}}else{if(B==34){D.preventDefault();var C=h.index+parseInt((s*(s>=20?0.1:0.5)));if(h.index!=C){m(C<s?C:s,true)}}else{if(B==46&&y.allowDelete){D.preventDefault();c(o[this.id])}else{if((B>=48&&B<=57)||(B>=65&&B<=90)){p(String.fromCharCode(B));D.preventDefault()}}}}}}}}}}}}})},z=function(C){if(!C||C.nodeType!==1){return}var D=function(R){if(typeof R!=="string"){return""}return R.replace(/^\s+|\s+$/g,"")},P=function(T,S,R){if(!T){return}S(T,R);T=T.firstChild;while(T){P(T,S,R);T=T.nextSibling}},B=function(S,R){if(S.nodeType!==1||S==R){return false}if(S!=R&&((S.getAttribute&&S.getAttribute("aria-hidden")=="true")||(S.currentStyle&&(S.currentStyle.display=="none"||S.currentStyle.visibility=="hidden"))||(document.defaultView&&document.defaultView.getComputedStyle&&(document.defaultView.getComputedStyle(S,"")["display"]=="none"||document.defaultView.getComputedStyle(S,"")["visibility"]=="hidden"))||(S.style&&(S.style.display=="none"||S.style.visibility=="hidden")))){return true}return false},J=function(V,T,R,U){if(!V||!T||V==T){return false}while(V){V=V.parentNode;var S=V.getAttribute?V.getAttribute("role"):"";S=(S!="presentation"&&S!="none")?false:true;if(!S&&V.getAttribute&&((!R&&D(V.getAttribute("aria-label")))||B(V,U))){return true}else{if(V==T){return false}}}return false};if(B(C,document.body)||J(C,document.body,true,document.body)){return}var M="",E="",H="",A=C.getAttribute("aria-describedby")||"",K=C.getAttribute("title")||"",N=false,G=C.getAttribute("role");G=(G!="presentation"&&G!="none")?false:true;var L=function(U,S,T){var R="";P(U,function(X,V){if(N||!X||(X.nodeType===1&&B(X,V))){return}var W="";if(X.nodeType===1){var ab=X.getAttribute("aria-labelledby")||"",Z=X.getAttribute("aria-label")||"",Y=X.getAttribute("title")||"",ae=X.getAttribute("role");ae=(ae!="presentation"&&ae!="none")?false:true}if(X.nodeType===1&&((!X.firstChild||(X==V&&(ab||Z)))||(X.firstChild&&X!=V&&Z))){if(!S&&X==V&&ab){if(!ae){var ac=ab.split(" ");for(var aa=0;aa<ac.length;aa++){var ad=document.getElementById(ac[aa]);W+=" "+L(ad,true,ad)+" "}}if(D(W)||ae){N=true}}if(!D(W)&&Z&&!ae){W=" "+D(Z)+" ";if(D(W)&&X==V){N=true}}if(!D(W)&&!ae&&(X.nodeName.toLowerCase()=="input"||X.nodeName.toLowerCase()=="select"||X.nodeName.toLowerCase()=="textarea")&&X.id&&document.querySelectorAll('label[for="'+X.id+'"]').length){var ad=document.querySelectorAll('label[for="'+X.id+'"]')[0];W=" "+D(L(ad,true,ad))+" "}if(!D(W)&&!ae&&(X.nodeName.toLowerCase()=="img")&&(D(X.getAttribute("alt")))){W=" "+D(X.getAttribute("alt"))+" "}if(!D(W)&&!ae&&Y){W=" "+D(Y)+" "}}else{if(X.nodeType===3){W=X.data}}if(W&&!J(X,V,false,V)){R+=W}},T);return R};M=L(C,false,C);N=false;if(K&&!G){H=D(K)}if(A&&!G){var Q="",I=A.split(" ");for(var F=0;F<I.length;F++){var O=document.getElementById(I[F]);Q+=" "+L(O,true,O)+" "}if(D(Q)){H=Q}}if(D(H)&&!G){E=H}M=D(M.replace(/\s/g," ").replace(/\s\s+/g," "));E=D(E.replace(/\s/g," ").replace(/\s\s+/g," "));if(M==E){E=""}return{name:M,desc:E}},l=[],p=function(A){for(var B=h.index+1;B<=s;B++){if(A.toLowerCase()==l[B].replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase()){m(B,true);return}}for(var B=0;B<h.index;B++){if(A.toLowerCase()==l[B].replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase()){m(B,true);return}}},v=function(B){o={};l=[];q={};s=0;var A=[];h.options=$A.query("#"+x.id+" > li > a",function(C,D){o[D.id]=C;l.push($A.getText(D));if(y.isMultiselect){q[D.id]=false}s=C;if(!B){$A.setAttr(D,{tabindex:"-1","aria-selected":"false"});if(!$A.getAttr(D,"aria-labelledby")&&!$A.getAttr(D,"aria-label")){$A.setAttr(D,{"aria-label":z(D).name})}}$A.setAttr(D,"aria-posinset",C+1);if(!B&&(y.isSortable||y.isMultiselect)){$A.setAttr(D,y.isSortable?"aria-grabbed":"aria-selected","false")}if(D.id){A.push(D.id)}});if(A.length){$A.setAttr(x,"aria-owns",A.join(" "))}$A.query("#"+x.id+" > li > a",function(C,D){$A.setAttr(D,"aria-setsize",s+1)});if(h.options.length===1||(h.empty&&h.options.length>0)){m(0)}h.empty=false};if(y.isMultiselect){$A.setAttr(x,"aria-multiselectable","true")}if(y.label){$A.setAttr(x,"aria-label",y.label)}v();b();h.val=function(C){if(typeof C==="number"){m(C)}else{if(C&&typeof C==="string"){m(o[C])}else{if(C&&j(C)&&y.isMultiselect){var A=function(E){for(var D=0;D<C.length;D++){if(C[D]==E){return true}}return false};for(var B=0;B<h.options.length;B++){if((A(h.options[B].id)&&$A.getAttr(h.options[B],"aria-selected")!="true")||(!A(h.options[B].id)&&$A.getAttr(h.options[B],"aria-selected")!="false")||(!C.length&&$A.getAttr(h.options[B],"aria-selected")!="false")){d.apply(h.options[B])}}}else{return n}}}};h.add=k;h.rem=function(C){var E=j(C),B=E?C:[C],D=[];for(var A=0;A<B.length;A++){D.push(!B[A]?null:c(B[A]&&typeof B[A]==="string"?o[B[A]]:B[A],true))}return E?D:D[0]};h.activate=d;h.grabbed=r;h.container=x;h.val(h.index)}})();